<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6750a4">
    <link rel="manifest" href="manifest.json">    
    <title>صلاتي - سوريا</title>
    <style>
        :root {
            --primary: #6750a4;
            --secondary: #eaddff;
            --bg: #fef7ff;
            --text: #1c1b1f;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #f0f0f0; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; 
        }

        .app-container { 
            background-color: var(--bg);
            width: 100%; max-width: 400px; height: 95vh;
            border-radius: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        header { 
            background-color: var(--primary); 
            color: white; padding: 25px 20px; 
            text-align: center; border-radius: 0 0 24px 24px;
        }

        #install-btn {
            display: none;
            background: #fff; color: var(--primary);
            border: none; padding: 8px 15px; border-radius: 20px;
            font-weight: bold; margin-top: 10px; cursor: pointer;
        }
        
        .selector-container { 
            padding: 20px; 
            display: flex;
            justify-content: center;
        }

        select {
            width: 80%; 
            padding: 12px; 
            border-radius: 16px;
            border: 2px solid var(--secondary); 
            background-color: white;
            font-size: 1.1rem; 
            color: var(--primary); 
            font-weight: bold;
            outline: none;
            cursor: pointer;
            
            
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            
     
            text-align: center;
            text-align-last: center; 
        }

        .prayer-list { flex: 1; padding: 0 20px 20px; overflow-y: auto; }
        
        .prayer-card { 
            background: white; border-radius: 16px; 
            padding: 18px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #eee;
            transition: 0.3s;
        }

        .prayer-name { color: var(--primary); font-weight: 600; font-size: 1.1rem; }
        .prayer-time { color: var(--text); font-weight: bold; font-size: 1.2rem; }
        
        #loader { display: none; color: white; font-size: 0.8rem; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <div id="hijri-date" style="font-size: 0.9rem; opacity: 0.9;">جاري التحميل...</div>
            <h1 style="margin: 5px 0; font-size: 1.6rem;">مواقيت الصلاة</h1>
            <div id="loader">تحديث المواعيد...</div>
            <button id="install-btn">تثبيت التطبيق</button>
        </header>

        <div class="selector-container">
            <select id="city-select" onchange="fetchPrayers()">
                <option value="Aleppo" selected>حلب</option>
                <option value="Damascus">دمشق</option>
                <option value="Homs">حمص</option>
                <option value="Hama">حماة</option>
                <option value="Lattakia">اللاذقية</option>
                <option value="Tartous">طرطوس</option>
                <option value="Idlib">إدلب</option>
                <option value="Daraa">درعا</option>
                <option value="Deir ez-Zor">دير الزور</option>
            </select>
        </div>

        <div class="prayer-list" id="prayer-list"></div>
    </div>

    <script>
        function convertTo12Hour(time) {
            let [hours, minutes] = time.split(':');
            hours = parseInt(hours);
            const modifier = hours >= 12 ? 'م' : 'ص';
            hours = hours % 12 || 12;
            return `${hours}:${minutes} ${modifier}`;
        }

        async function fetchPrayers() {
            const city = document.getElementById('city-select').value;
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            
            try {
                // الطريقة 1 (جامعة العلوم الإسلامية بكراتشي) هي الأنسب لسوريا
                const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Syria&method=1`);
                const result = await response.json();
                const timings = result.data.timings;
                
                document.getElementById('hijri-date').innerText = 
                    `${result.data.date.hijri.day} ${result.data.date.hijri.month.ar} ${result.data.date.hijri.year} هـ`;

                const prayerNames = {
                    'Fajr': 'الفجر',
                    'Dhuhr': 'الظهر',
                    'Asr': 'العصر',
                    'Maghrib': 'المغرب',
                    'Isha': 'العشاء'
                };

                let html = '';
                for (let key in prayerNames) {
                    html += `
                        <div class="prayer-card">
                            <span class="prayer-name">${prayerNames[key]}</span>
                            <span class="prayer-time">${convertTo12Hour(timings[key])}</span>
                        </div>`;
                }
                document.getElementById('prayer-list').innerHTML = html;
            } catch (e) {
                document.getElementById('prayer-list').innerHTML = '<p style="text-align:center">خطأ في الاتصال</p>';
            } finally {
                loader.style.display = 'none';
            }
        }

        // التشغيل الأول (سيبدأ بحلب تلقائياً)
        fetchPrayers();

        // كود التثبيت PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-btn').style.display = 'inline-block';
        });

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt = null;
                document.getElementById('install-btn').style.display = 'none';
            }
        });
        // تسجيل Service Worker بسيط لجعل المتصفح يقبل التثبيت
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}

    </script>
</body>
</html>
