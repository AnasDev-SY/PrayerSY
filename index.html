<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6750a4">
    <title>ØµÙ„Ø§ØªÙŠ - Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</title>
    <style>
        :root {
            --primary: #6750a4;
            --secondary: #eaddff;
            --bg: #fef7ff;
            --text: #1c1b1f;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #f0f0f0; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; 
        }

        .app-container { 
            background-color: var(--bg);
            width: 100%; max-width: 400px; height: 95vh;
            border-radius: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        header { 
            background-color: var(--primary); 
            color: white; padding: 25px 20px; 
            text-align: center; border-radius: 0 0 24px 24px;
        }

        .search-container { 
            padding: 20px; 
            display: flex; gap: 8px;
            justify-content: center;
        }

        input[type="text"] {
            flex: 1; padding: 12px; border-radius: 12px;
            border: 2px solid var(--secondary); outline: none; font-size: 1rem;
        }

        .search-btn {
            background: var(--primary); color: white; border: none;
            padding: 0 15px; border-radius: 12px; cursor: pointer; font-weight: bold;
        }

        .prayer-list { flex: 1; padding: 0 20px 20px; overflow-y: auto; }
        
        .prayer-card { 
            background: white; border-radius: 16px; 
            padding: 18px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #eee;
        }

        .prayer-name { color: var(--primary); font-weight: 600; font-size: 1.1rem; }
        .prayer-time { color: var(--text); font-weight: bold; font-size: 1.2rem; }
        
        #loader { display: none; color: white; font-size: 0.8rem; margin-top: 5px; }
        #location-status { font-size: 0.9rem; font-weight: bold; margin-top: 5px; display: block;}
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <div id="hijri-date" style="font-size: 0.9rem; opacity: 0.9;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <h1 style="margin: 5px 0; font-size: 1.6rem;">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1>
            <div id="location-status">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>
            <div id="loader">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </header>

        <div class="search-container">
            <input type="text" id="city-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø¯ÙˆØ±ØªÙ…ÙˆÙ†Ø¯)" onkeypress="if(event.key === 'Enter') fetchBySearch()">
            <button class="search-btn" onclick="fetchBySearch()">Ø¨Ø­Ø«</button>
        </div>

        <div class="prayer-list" id="prayer-list"></div>
    </div>

    <script>
        const cityMapping = {
            "Ø¯Ù…Ø´Ù‚": "Damascus", "Ø¯ÙŠÙ…Ø´Ù‚": "Damascus", "Ø¯ÙˆØ±ØªÙ…ÙˆÙ†Ø¯": "Dortmund",
            "Ø¯Ø±ØªÙ…ÙˆÙ†Ø¯": "Dortmund", "Ø¨Ø±Ù„ÙŠÙ†": "Berlin", "Ø­Ù„Ø¨": "Aleppo",
            "Ù…ÙƒØ©": "Mecca", "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©": "Medina", "Ø§Ø³Ø·Ù†Ø¨ÙˆÙ„": "Istanbul", "Ø¥Ø³Ø·Ù†Ø¨ÙˆÙ„": "Istanbul"
        };

        function convertTo12Hour(time) {
            let [hours, minutes] = time.split(':');
            hours = parseInt(hours);
            const modifier = hours >= 12 ? 'Ù…' : 'Øµ';
            hours = hours % 12 || 12;
            return `${hours}:${minutes} ${modifier}`;
        }

        window.onload = () => startApp();

        async function startApp() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (pos) => {
                        const lat = pos.coords.latitude;
                        const lng = pos.coords.longitude;
                        const cityName = await getCityNameFromCoords(lat, lng);
                        fetchPrayers(lat, lng, true, cityName);
                    },
                    (err) => {
                        document.getElementById('location-status').innerText = "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯ÙŠÙ†ØªÙƒ ÙŠØ¯ÙˆÙŠØ§Ù‹";
                    }
                );
            }
        }

            async function getCityNameFromCoords(lat, lng) {
            try {
            // Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« google-maps-like Ø¨Ø³ÙŠØ· ÙˆÙ…Ø¬Ø§Ù†ÙŠ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„
            const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=ar`);
            const data = await res.json();
            
            // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
            return data.city || data.locality || data.principalSubdivision || "Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ";
            } catch (e) { 
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…:", e);
            return "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ"; 
            }
        }

        async function fetchBySearch() {
            let query = document.getElementById('city-input').value.trim();
            if (!query) return;
            const fixedCity = cityMapping[query] || query;
            fetchPrayers(null, null, false, fixedCity);
        }

        async function fetchPrayers(lat, lng, isGPS, cityQuery = "") {
            const loader = document.getElementById('loader');
            const status = document.getElementById('location-status');
            const list = document.getElementById('prayer-list');
            loader.style.display = 'block';
            
            let url = isGPS 
                ? `https://api.aladhan.com/v1/timingsByAddress?address=${lat},${lng}&method=1`
                : `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(cityQuery)}&country=&method=1`;

            try {
                const response = await fetch(url);
                const result = await response.json();
                if (result.code !== 200) throw new Error();

                const data = result.data;
                document.getElementById('hijri-date').innerText = 
                    `${data.date.hijri.day} ${data.date.hijri.month.ar} ${data.date.hijri.year} Ù‡Ù€`;
                
                status.innerText = isGPS ? `ğŸ“ ${cityQuery}` : `ğŸ™ï¸ ${cityQuery}`;

                const prayerNames = {'Fajr': 'Ø§Ù„ÙØ¬Ø±', 'Dhuhr': 'Ø§Ù„Ø¸Ù‡Ø±', 'Asr': 'Ø§Ù„Ø¹ØµØ±', 'Maghrib': 'Ø§Ù„Ù…ØºØ±Ø¨', 'Isha': 'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
                let html = '';
                for (let key in prayerNames) {
                    html += `<div class="prayer-card">
                        <span class="prayer-name">${prayerNames[key]}</span>
                        <span class="prayer-time">${convertTo12Hour(data.timings[key])}</span>
                    </div>`;
                }
                list.innerHTML = html;
            } catch (e) {
                list.innerHTML = '<p style="text-align:center; color:red; padding:20px;">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¯Ù‚ÙŠÙ‚Ø©. Ø­Ø§ÙˆÙ„ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.</p>';
            } finally {
                loader.style.display = 'none';
            }
        }
    </script>
</body>
</html>